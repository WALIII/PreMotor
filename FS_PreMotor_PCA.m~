function FS_PreMotor_PCA(Cal,Aln);


Aln{1};
AlignBound = 150:250;%Alignment Boundries ((Aln{1}-20):(Aln{1}


for group = 1:3;%1:size(Cal,2) % Each 'Group' is a subset of aligned data
    clear CaSignal;
    clear GG
    clear GG_TOT
    
    figure();
for trial = 1:size(Cal{1,group}{1,1},1)
for cell = 1:size(Cal{1,group},2)
CaSignal(trial,:,cell) = Cal{1,group}{1,cell}(trial,:);

end

GG = squeeze(CaSignal(trial,AlignBound,:)); 
TX = size(GG,1);
clear CaSignal;
try
GG_TOT = vertcat(GG_TOT,GG);
catch
    GG_TOT = GG;
end
clear GG;
end

% Run PCA on total concatnated CA data.
[coeff,score] = princomp(GG_TOT);
GG_TOT_tot{group} =GG_TOT;
clear GG_TOT
% Get scores for each dim
z1 = score(:,1);
x1 = score(:,2);
y1 = score(:,3);
% plot
hold on;
plot(1:length(z1),x1,'r');
hold on;
plot(1:length(z1),y1,'g');
plot(1:length(z1),z1,'b');




figure();
for trial = 1:size(Cal{1,group}{1,1},1)
range = (1:TX)+TX*(trial-1);
z1a = score(range,1);
x1a = score(range,2);
y1a = score(range,3);

hold on;
plot(1:length(x1a),x1a,'r');
hold on;
plot(1:length(y1a),y1a,'g');
plot(1:length(z1a),z1a,'b');
end


end


FIn = vertcat(GG_TOT_tot{1},GG_TOT_tot{2},GG_TOT_tot{3});
[coeff,score] = princomp(FIn);



% Get scores for each dim
z1 = score(:,1);
x1 = score(:,2);
y1 = score(:,3);
% plot
figure();
title('final countdown, all PCA')
hold on;
plot(1:length(z1),x1,'r');
hold on;
plot(1:length(z1),y1,'g');
plot(1:length(z1),z1,'b');




%%% The final cut
A = size(GG_TOT_tot{1},1);
B = size(GG_TOT_tot{2},1);
C = size(GG_TOT_tot{3},1);

G_final{1} = score(1:A,:);
G_final{2} = score((1+A):(A+B),:);
G_final{3} = score((1+A+B):(A+B+C),:);


clear z1a
clear x1a
clear y1a
clear w1a

for group = 1:3;
    
clear range;

for trial = 1:size(Cal{1,group}{1,1},1)
range = (1:TX)+TX*(trial-1);
trial
x1a{group}(trial,:) = G_final{group}(range,2);
y1a{group}(trial,:) = G_final{group}(range,3);
z1a{group}(trial,:) = G_final{group}(range,4);
w1a{group}(trial,:) = G_final{group}(range,5);

hold on;

subplot(1,3,group)
hold on;
plot(1:length(x1a{group}(trial,:)),x1a{group}(trial,:),'r');
plot(1:length(y1a{group}(trial,:)),y1a{group}(trial,:),'g');
plot(1:length(z1a{group}(trial,:)),z1a{group}(trial,:),'b');
% plot(1:length(w1a),w1a,'m');


end



end

figure(); 
subplot(4,1,1)
hold on;
plot(x1a{1}(:,:)','r');
plot(x1a{2}(:,:)','g');
plot(x1a{3}(:,:)','b');
subplot(4,1,2)
hold on;
plot(y1a{1}(:,:)','r');
plot(y1a{2}(:,:)','g');
plot(y1a{3}(:,:)','b');
subplot(4,1,3)
hold on;
plot(z1a{1}(:,:)','r');
plot(z1a{2}(:,:)','g');
plot(z1a{3}(:,:)','b');

subplot(4,1,4)
hold on;
plot(w1a{1}(:,:)','r');
plot(w1a{2}(:,:)','g');
plot(w1a{3}(:,:)','b');
    
    





